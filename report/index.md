# 项目背景

## 业务需求分析

我根据我喜欢的方向进行了较为综合的多维度分析，最终决定了制作这款基于手机游戏《明日方舟*1*》的材料掉落概率查询工具。该作品是为了方便该游戏的玩家如果需要某个材料*2*，前往哪个关卡*3*可以更快速地获取*4*，同时所需要的理智*5*更少。

注释：

1. 明日方舟：《明日方舟》是一款魔物主题的策略手游。在游戏中，玩家将管理一艘满载&quot;魔物干员&quot;的方舟，为调查来源神秘的矿石灾难而踏上旅途。在这个宽广而危机四伏的世界中，你或许会看到废土中的城市废墟，或许会看到仿若幻境的亚人国度，或许会遭遇无法解读的神秘，或许参与无比残酷的战争。在有关幻想与异种生命的世界中，体验史诗与想象，情感与牵绊！
2. 材料：&quot;材料&quot;即是该游戏中的&quot;物资&quot;，包括但不限于虚拟物资、需要购买的物资等等。玩家可以使用材料给干员*6*提升等级，同时大部分材料需要前往关卡进行获取，有关于关卡的更多介绍请查阅下一条注释。
3. 关卡：&quot;关卡&quot;是该游戏中对于不同关卡的统称，每个关卡都可以获得不同的材料，而且同类型的关卡所获得材料的概率是不同的。所以对于一些玩家来说，如何在有限的时间和有限的理智中获取最多的材料是一个值得研究的课题。
4. 快速获取：此处所指的是使用的时间最少，即每通关一次关卡，所需要的时间低于同材料的其他关卡。
5. 理智：&quot;理智&quot;指的是该游戏中对于&quot;体力&quot;的代称，所有玩家的体力都是有限的，同时进入关卡需要消耗一定数量的体力。那么在同样理智的情况下，能获得更多需要获取的材料数量的关卡就是更值得进入的关卡。
6. 干员：&quot;干员&quot;是该游戏中&quot;角色&quot;的代称，每名干员升级都离不开材料。

## 架构分析

因图片过大，如果看不清，请查看同级目录下的同名PDF文件。

![UML 图片](https://raw.githubusercontent.com/Rominwolf/wtgm/master/report/uml.png)

## 数据库设计分析

| **行名** | **类型** | **主键** | **自增** | **备注** |
| - | - | - | - | - |
| id | integer | √ |   | 材料的唯一ID |
| name\_chinese | text |   |   | 材料的中文名 |
| name\_english | text |   |   | 材料的英文名 |
| star | integer |   |   | 材料是否被标记（默认为0）0=未标记，1=已标记 |

*materials表用来存放各个材料的基础数据，即各个材料的中文名、英文名和被标星的状态。*

| **行名** | **类型** | **主键** | **自增** | **备注** |
| - | - | - | - | - |
| id | text | √ |   | 关卡的唯一编号，使用语言_区域/关卡ID进行存档（例如zh_CN/main_06-03） |
| code | text |   |   | 关卡的代码 |
| sp_cost | integer |   |   | 进入关卡所需的理智数 |
| name | text |   |   | 关卡的名称 |
| description | text |   |   | 关卡的简介 |

*stages表用来存放已经解析过的关卡的基础数据，即关卡编号、关卡代码、关卡费用、关卡名称和关卡简介。*

| **行名** | **类型** | **主键** | **自增** | **备注** |
| - | - | - | - | - |
| id | integer | √ | √ | 用户的唯一ID |
| username | text |   |   | 用户名 |
| password | text |   |   | 用户密码 |

*users表用来存放用户的基础数据，即用户唯一ID、用户名和用户密码。*

| **行名** | **类型** | **主键** | **自增** | **备注** |
| - | - | - | - | - |
| k | text | √ |   | 键项，即key |
| v | text |   |   | 值项，即value |

*settings表用来存放应用的一些设置信息。*

## 界面需求分析

关于界面设计，在该应用中我设想了10个不同的页面，分别是：

1. **首页**：即应用的初始化界面，用于跳转到其他界面和展示用户标记过的材料的最佳关卡列表。该界面包含：Logo 图片框、标题标签、登录与注册按钮、选择材料按钮、标记材料列表和设置按钮等控件，该页面为一级页面；
2. **登录界面**：即用户进行登录的界面，同时如果用户未注册过则支持跳转到注册界面进行注册，否则点击登录按钮则进行账户判断跳转到用户界面。该界面包含：用户名文本框、密码文本框、登录按钮和注册按钮等控件，该页面为二级页面；
3. **注册界面**：即用户进行注册的界面，如果用户曾未进行注册过则可以用过该界面进行注册，注册完毕后会自动登录并跳转到用户界面。该界面包含：用户名文本框、密码文本框、确认密码文本框、同意协议复选框和注册按钮等控件，该页面为三级页面。
4. **选择材料界面**：即所有可以刷取到的材料图片按钮组合，点击各个按钮即可跳转到各个材料的相关页。该界面包含：各个材料的图片按钮组合，该页面为二级页面；
5. **材料掉落界面**：即用户选定材料的掉落概率关卡列表，关卡按照材料掉落率进行降序排序，点击各个关卡可以获取该关卡的简单属性。该界面包含：不同关卡的掉落概率列表、材料图片框、材料名标签和标记按钮等控件，该页面为三级页面；
6. **设置界面**：即用户设置该应用的界面，目前支持切换应用的显示语言和切换企鹅物流的材料掉落服务器。该界面包含：选择区服列表框、切换语言列表框和进入关于界面按钮等控件，该页面为二级页面；
7. **用户界面**：即用户的用户信息界面。该界面包含：头像图片框、用户名标签、用户ID标签、退出账号按钮、修改密码按钮和修改用户名按钮等控件，该页面为三级页面；
8. **修改用户信息界面**：即用户修改自己的个人信息或删除账户的界面，根据用户选择的不同类型，判断要进行的下一步操作。该节目包含：要修改的内容标签、修改的内容文本框和提交按钮等控件，该页面为四级页面；
9. **关于界面**：即关于该应用的一些信息界面。该界面包含：支持列表等控件，该页面为三级页面；
10. **关卡界面**：即某个关卡的基本信息界面。该界面包含：关卡代码标签、关卡编号标签、危险等级标签、获得经验标签、理智消耗标签、失败返还理智标签和关卡简介标签等控件，该页面为四级页面。

## 开发工具和环境

本应用使用Android Studio 4.0.1 版本开发，使用Gradle 6.1.1 版本进行构建生成。

编译器SDK 版本API 30 (Android 10+)，最小SDK 版本API 22 (Android 5.1)。

构建工具版本30.0.3。

# 项目功能与实现

## 项目目标描述

### 获取材料掉落矩阵的目标

1. 进入材料查询界面，并点击欲查询的材料图片按钮；
2. 从企鹅物流服务器获取到该材料的所有可以获取到的关卡列表；
3. 获取完毕后进行解析，同时解析关卡文件的数据；
4. 分析一个个关卡，如果该关卡信息已经保存到数据库中则直接调用数据库的数据，否则解析关卡文件中该关卡的数据，之后将该关卡信息提交到数据库；
5. 分析该关卡的指定材料的掉落概率和&quot;理智指数&quot;数值；
6. 根据掉落概率进行降序排序，并返回数组列表；
7. 展示在界面前台，流程完毕。

### 设置标星状态的目标

1. 进入某个材料的掉落矩阵界面；
2. 点击右上角的标星按钮：如果该材料已经被标星，则取消标星，否则被标星；
3. 与此同时将数据库内该材料的star字段置反。

### 展示标星列表的目标

1. 加载首页后获取被标星的材料列表；
2. 一个个获取指定材料的掉落矩阵和关卡数据（步骤同获取材料掉落矩阵）；
3. 获取完毕后将最佳的关卡信息和掉落率展示在前台。

### 登录的目标

1. 进入登录界面，如果该用户有账号，则输入用户名和密码并点击登录；
2. 判断输入框是否不为空，如果为空则返回错误；
3. 判断该用户名是否存在于数据库，如果不存在则返回错误；
4. 判断该用户输入的密码是否和数据库中的密码匹配，如果验证失败则返回错误；
5. 登录成功，跳转至用户界面，流程结束。

### 注册的目标

1. 如果该用户没有账号，则进入注册界面进行账号注册；
2. 用户输入用户名、密码和确认密码等必选的内容；
3. 判断协议复选框是否被选中，如果未选中则无法进行注册；
4. 判断输入框是否不为空，如果为空则返回错误；
5. 判断两次密码是否相同，如果不相同则返回错误；
6. 判断该用户输入的用户名是否已经存在于数据库，如果存在则返回错误；
7. 注册成功，自动进行登录，跳转至用户界面，流程结束。

## 创新点或原创设计描述

* 使用到了网络相关的请求。以便于通过HTTP访问到企鹅物流的服务器，并获取到最新的材料掉落矩阵数据；
* 使用到了线程操作。因为在Android 4.0之后在主线程里面执行网络请求都会报NetworkOnMainThreadException的异常，虽然有强制在主线程中访问网络的方法，但最终还是决定使用线程进行异步操作，因为官方不推荐在主线程中进行网络请求，一是容易造成线程堵塞，即程序假死，影响用户体验，二是不好进行代码维护。
* 使用到了异步消息的处理操作。由于Android的UI操作不是线程安全的，即线程不采用加锁机制，不采用数据访问保护，可以多个线程同时进行操作，可能导致最后获得的数据来自于多个其他线程，导致获取的数据和预想的结果不一致。所以如果要从其他线程中返回数据到主线程，需要用到Handler方法来确保线程安全，确保不会出现数据和预想的不一致或数据被污染。
* 使用到了更符合玩家需求的&quot;理智概率&quot;算法，即根据指定材料在指定关卡的掉落概率和关卡消耗的理智按照指定公式进行分析，得到的结果按照升序排序。公式为：[关卡消耗的理智] * 1.0 * 100 / [掉落概率] * 1.0。
* 使用到了Java的Json解析相关方法。因为从企鹅物流中获取的数据均为Json编码的结果，所以如果需要提取数据的话，则需要再进行Json解析。
* 使用到了Java集合框架的排序方法。因为需要进行将掉落概率的关卡列表按照指定key进行排序。
* 用户密码使用了Bcrypt 算法进行加密，而不使用明文保存密码，这样提供了安全性较高的加密，保证用户加密后的密码即使泄露了也至少需要很久才能被破解（官方说密码越复杂，字典破解的时间越久，至少为10年）。
* 提供了切换语言的功能，即Internationalization国际化。让没有学过中文的非中文语种的玩家也可以正常且友好地使用本应用。
* 为应用提供了一个全局类，即G class。可以实现在任意类中都可以调用到部分方法。
* 使用到了assets文件夹以便存放一些基础文件。
* 为应用自定义了显示的字体。

## 文件组织结构截图

![目录树 图片](https://raw.githubusercontent.com/Rominwolf/wtgm/master/report/0.png)

### 各类文件说明

#### 界面文件说明

**support\_item\_layout.xml**：关于本应用界面中关于列表的单项模板布局文件。

**stages\_list\_layout.xml**：材料掉落概率界面中关卡列表的单项模板布局文件。

**main\_star\_materials\_list\_layout.xml**：首页标星列表的单项模板布局文件。

**activity\_user\_info.xml**：用户信息的界面布局文件，用于展示用户的各个信息。

**activity\_support.xml**：关于本应用的界面布局文件，用于展示关于列表。

**activity\_stage\_info.xml**：关卡信息的界面布局文件，用于展示指定关卡的简略信息的布局。

**activity\_setting.xml**：应用设置的界面布局文件，用于提供修改应用属性的布局。

**activity\_register.xml**：用户注册的界面布局文件，用于提供用户注册的布局。

**activity\_material.xml**：材料的掉落概率统计的界面布局文件，用户展示各个材料的各个关卡的掉落概率。

**activity\_main.xml**：应用的主界面布局文件。

**activity\_login.xml**：用户登录的界面布局文件，用于提供用户登录的布局。

**activity\_edit\_user\_info.xml**：编辑用户信息的界面布局文件，用于显示、修改用户的信息。

**activity\_choose\_materials.xml**：选择材料的界面布局文件，用于展示各个材料的图片按钮。

#### Java文件说明

**activity/ChooseMaterial.java**：选择某项材料的界面代码，点击各个图片按钮会跳转到相关联的材料掉落页。

**activity/EditUserInfoActivity.java**：修改用户信息的界面代码，用户可以登录后在此界面内修改指定的数据，例如用户名、密码或删除账号等操作。

**activity/LoginActivity.java**：用户登录的界面代码，用户可以在此处进行登录，如果没有账户可点击注册按钮跳转到注册页进行用户注册。

**activity/MainActivity.java**：应用主界面代码，是连接到其他界面的第一道桥梁，同时，首页支持显示标记星星了的材料列表——即显示该材料最佳的刷图关卡。

**activity/MaterialActivity.java**：材料掉落统计的界面代码，用于获取指定材料的关卡掉落概率列表，获取的列表根据掉落率降序排序，同时根据&quot;理智指数&quot;算法获取了根据理智的掉落指数。点击列表的单项可以跳转到该关卡的简易信息界面。

**activity/RegisterActivity.java**：用户注册的界面代码，当用户没有账户时可以通过该界面进行注册，注册成功后会自动进行登录，并跳转到用户界面。

**activity/SettingActivity.java**：应用设置的界面代码，用于修改该应用支持修改的属性，目前支持修改&quot;应用显示语言&quot;和&quot;获取材料掉落概率的服务器&quot;两个功能，同时支持跳转到关于本应用界面。

**activity/StageInfoActivity.java**：关卡简易信息的界面代码，用于查询指定关卡的简单信息并显示在界面上。

**activity/SupportActivity.java**：关于本应用的界面代码，用于获取关于本应用的信息。

**activity/UserInfoActivity.java**：用户信息的界面代码，用于加载用户信息，虽然目前该界面没有什么实质性的功能。

**bean/MaterialDropBaseInfo.java**：材料掉落的简易信息的字段封装包。

**bean/MaterialNameConvert.java**：材料ID语言转换的字段封装包。

**bean/StageBaseInfo.java**：关卡简易信息的字段封装包。

**bean/SupportBaseInfo.java**：关于本应用的字段封装包。

**utils/GlobalApp.java**：应用的全局方法封装包。

**utils/PenguinStats.java**：企鹅物流的封装包。

**utils/SmartUtils.java**：方便快速调用的方法封装包。

**utils/SqLiteHelperUtil.java**：使用 SQLite 数据库的方法封装包。

**utils/StagesUtil.java**：关卡相关的方法封装包。

**utils/Toaster.java**：快速创建吐司的方法封装包。

**utils/HttpUtil.java**：使用第三方开发者开源发布的网络请求的封装包。

**utils/Bcrypt.java**：使用第三方开发者开源发布的基于Bcrypt 加密算法的封装包。

#### 其他文件说明

**assets/stages\_table/en\_US.json**：关卡数据JSON 文件（英文（美国））。

**assets/stages\_table/zh\_CN.json**：关卡数据JSON 文件（中文（中国））。

**assets/supports/en\_US.json**：关于本应用的数据JSON 文件（英文（美国））。

**assets/supports/zh\_CN.json**：关于本应用的数据JSON 文件（中文（中国））。

**assets/materials\_name\_convert.txt**：材料ID转换成其他语言的文本文档文件。

**res/drawable/doctor\_avatar.png**：博士头像图片文件。

**res/drawable/logo.png**：应用图标图片文件。

**res/drawable/material\_X.png**：材料图片文件。

**res/drawable/setting.png**：设置图标图片文件。

**res/drawable/star.png**：暂未标星图片文件。

**res/drawable/starred.png**：已标星图片文件。

**res/drawable/userinfo\_background.png**：用户界面背景图图片文件。

**res/font/materialdesignicons.ttf**：企鹅物流字体文件。

**res/font/source\_bold.otf**：思源黑体（粗体）字体文件。

**res/font/source\_regular.otf**：思源黑体（常规）字体文件。

**res/values/arrays.xml**：数组资源分配文件。

**res/values/colors.xml**：颜色资源分配文件。

**res/values/dimens.xml**：尺寸资源分配文件。

**res/values/strings.xml**：字符串资源分配文件。

**res/values/styles.xml**：样式资源分配文件。

# 使用方法

## 项目功能界面截图

![首页 图片](https://raw.githubusercontent.com/Rominwolf/wtgm/master/report/main.png)

![选择材料 图片](https://raw.githubusercontent.com/Rominwolf/wtgm/master/report/choose_material.png)

![材料掉落矩阵 图片](https://raw.githubusercontent.com/Rominwolf/wtgm/master/report/material.png)

![关卡信息 图片](https://raw.githubusercontent.com/Rominwolf/wtgm/master/report/stage_info.png)

![登录 图片](https://raw.githubusercontent.com/Rominwolf/wtgm/master/report/login.png)

![注册 图片](https://raw.githubusercontent.com/Rominwolf/wtgm/master/report/register.png)

![用户信息 图片](https://raw.githubusercontent.com/Rominwolf/wtgm/master/report/user_info.png)

![编辑用户 图片](https://raw.githubusercontent.com/Rominwolf/wtgm/master/report/edit_user.png)

![设置 图片](https://raw.githubusercontent.com/Rominwolf/wtgm/master/report/setting.png)

![关于 图片](https://raw.githubusercontent.com/Rominwolf/wtgm/master/report/about.png)

## 功能描述

**获取材料编号与名称信息：**所有可以刷到的材料的编号、名称均保存到了文件 materials\_name\_convert.txt 文件内，在第一次启动应用时会自动解析并插入到数据库 materials 表中，以便于后续再次调用。

**获取材料掉落矩阵列表：**在此使用了企鹅物流的对外开放接口，提供了从企鹅物流中获取到最新的材料掉落矩阵，之后通过解析和分析获取到了各个关卡的掉落率和&quot;理智指数&quot;数值。

**获取关卡列表：**截止到该文档提交之前的所有关卡的数据均保存到了文件 stages/语言\_地区\.json 文件内，在初次获取指定关卡时，会解析该JSON文件，之后会保存该关卡的简单数据到数据库stages表内，第二次即以后便会直接从数据库中调用，大大提升了获取速度，典型的以空间换时间的方法。

**将某个材料标记或取消标记：**如果你觉得某个材料经常会用到、时不时就会去刷，那么你可以将那个材料标记（即标星），被标记的材料会直接显示在首页的底部快速查阅列表中，当然，你也可以随时取消标记。最多支持标记七种材料。

**获取关卡详情信息：**支持获取指定关卡的简单信息，当你点击关卡列表中的一个关卡时，会获取该关卡的简易信息并显示在界面中。

**将标记的材料展示在首页：**当首页处于前台（或焦点）时，会自动刷新你标过星的材料列表，受限于网络请求速度，标星的材料数量和加载时间成正比。标记过的材料会展示其最值得刷的关卡代码和掉落率，点击列表即可跳转到该材料的掉落概率统计界面。

**用户登录或注册：**提供简单的用户登录和注册功能，用户信息将保存到数据库 users 表中。在注册及登录的时候会进行账户验证，确保该用户的密码是否输入正确、数据库中是否已经存在该用户。同时，为了提供更好的安全性，密码使用 Bcrypt 算法进行加密。

**用户信息修改：**你可以修改你的用户信息，目前支持修改用户名和密码。在修改完毕后将自动登出账号，请使用新的信息进行登录。

**账户删除：**当你不打算使用某个账号时，你可以删除该账户。为了防止&quot;手滑&quot;或恶意删除，在删除的时候，需要提供你的账户密码进行验证，如果验证失败则无法进行删除。

**登出账户与用户数据长时保存：**当你登录账户后，除非手动登出或退出应用，你的账户将不会被登出。

**切换应用显示语言：**该应用提供了多语言支持（目前只支持&quot;简体中文-中国&quot;和&quot;英语-美国&quot;两种语言），并且切换语言后会即时更新，同时会自动根据你的系统语言选择显示的语言。

**切换材料掉落服务器：**该应用提供了切换企鹅物流获取材料掉落矩阵的服务器，当切换服务器后会即时更新服务器，下次获取材料的掉落矩阵时会自动按照选定的服务器进行获取。

# 心得体会

经过本次的项目设计，我了解到了Android和Java平台的一些体系、约束与开放性。

在本次设计的过程中，在一边掌握曾经学习过的知识的同时，也在时时刻刻学习着曾经没有听说过或没有深入的新知识。因为以我现在所拥有的知识储备，一边查资料、一边写项目是最好的解决方案。实际上，任何时候这都是最好的解决方案，因为“实践是最好的老师，自己解决的问题才会记得更牢固”。

在编写项目的时候，我也必然遇到了一些曾经没有了解过的问题，虽然最后都解决了，但采用的解决方案并不是最好的，如果以后还有机会更深入了解Android和Java的设计机制，时间和空间复杂度都更简单的方法才会更值得采用。

在此，我简单总结了一下该项目在制作的过程中遇到的一些问题，以及该应用在设计的过程中所设想的重点、遇到的难点：

**获取材料掉落概率与网络请求服务的问题**

在一开始设想从企鹅物流API中获取材料掉落矩阵的流程中，我想的是从企鹅物流获取数据到应用内、应用解析数据、显示在前台，但实际操作的过程中发现并没有想象的那么简单。

首先就是获取不到数据，一开始我以为只是简单的请求链接输入错误的问题，但经过几次检查和测试发现并没有问题，每一个字符都相同，连MD5校验的值都是一样的，所以最后并不是输入错误的问题。接着我认为会不会是国内访问不到企鹅物流的服务器的问题，因为他们所使用的服务器似乎并不在中国内地，于是我手动在虚拟机中通过浏览器访问请求链接，发现并不然，网页可以正常打开，结果也是正常的，所以该方案也是无效的。

那么究竟是什么问题呢？*请原谅我当时没有想起来看调试日志的输出内容。*

问题很简单，就是“无法进行网络请求”，官方声明在Android 4.0无法在主线程中进行网络请求了，而我以为（对，又是我以为）和PHP差不多，可以直接随时进行网络请求，不用再单独创建一条子线程来进行网络请求的操作，所以一开始我就没有往这方面去想，所以只要保证有关网络请求的操作均在子线程中操作就行了，很简单嘛。

嘿嘿，想太多。

**异步线程操作与异步消息处理操作的问题**

数据获取是获取到了，我又遇到了一个新的棘手的问题——子线程无权修改界面（主线程）的组件。

这个问题我记得当时我去网上四处寻找解决方案，国内的要不是用不了，就是根本没有，外网也差不多。虽然没有报错，但就是无法传递数据。

虽然我了解到了Handler消息处理的机制，但问题就出现在这里，它就是不给我传。

最后我都打算“曲线救国”了，无意间进入了一个现在已经记不太清的回复，他说“再new一个Handler回调”，于是我打算试一试呗，万一有用呢。

不试不知道，一试吓一跳，Amazing啊！传过去了！

原因往往很简单，只需要使用

> new Handler(new Handler.Callback() {});

就行！

这样问题就解决了，感觉就像是在洞穴中看到了一束光一样，不是人造光、也不是幻视，是真的一道光，径直地照射到了我的眼前，我抓住了那束光，跟着光回到了地面。

（好中二的描述，是我文笔不行，实在是不知道说什么感谢他了）

**应用切换语言与即时刷新的问题**

为什么我会考虑增加其他语言而不仅限于使用中文呢？

最主要的原因就是我那个马来西亚的朋友也想用这款应用，但可惜的是当时并不支持切换语言（只有中文），所以……实现多语言呗！

翻译语言与实现多语言并不是最困难的事情，最难的问题是如何切换语言并实时更新显示的语言，查阅了很多资料，虽然也算是实现了这项功能，也算是“即时”切换语言，因为在我的设备上是可以随时更改语言且再次进入会显示上次保存了的语言的。

但可惜的是并不是所有设备都可以很完美地无缝切换语言，比如那个海外朋友测试的时候就会出现当切换为英文后退出英语再次进入会返回成中文的现象……

但受限于样本过少与不好使进行调试的限制，该问题暂时我也不清楚如何完美解决。

**关卡数据解析与加载速度优化的问题**

在获取关卡数据的时候，一开始我设想的是加载保存关卡数据的文件，通过JSON解析后获取指定关卡的数据。

但真正落实并测试时，发现获取的速度实在是太慢了！如果列表里只有寥寥几个关卡还好，但一旦关卡数量多起来，加载的时间就会成倍数提升！比如说加载一个数目为50条的关卡列表，如果使用JSON解析，则单次花费时间至少为1分多钟，但如果不获取关卡数据，仅需几秒钟。

所以如何让加载速度变快，是一个迫在眉睫的问题。

于是我和另一个挚友想了以下几种值得尝试的解决方法：

1. 将每次获取的材料掉落矩阵保存到数据库，这样下次请求同材料的时候直接获取数据库的缓存，当用户手动刷新时才清理缓存重新获取。这样的好处是巨快无比，因为不需要网络请求和解析JSON，几乎是一瞬间就可以查询到，但不好的方面就是获取的数据不是最新的，需要用户手动刷新，如果遇到某个关卡的掉落率超过了当前最佳的关卡，那么用户不刷新是不知道的；

2. 当加载新关卡时，将关卡的简单数据保存到数据库，然后获取材料的掉落矩阵时如果数据库中已存在该关卡的信息，则直接调用该信息，否则进行JSON解析，并将该关卡的数据保存到数据库。这样的好处是每个关卡都单独保存到了数据库，今后调用的时候也可以方便调用，但不好的方面就是加载的速度相比上一种方案会略逊色一些，毕竟还是需要网络请求的，如果遇到没有加载过的关卡，还得需要解析。

3. 在获取材料掉落矩阵的时候，每一列每一列地显示，即获取到一个关卡的掉落率就回调到前台进行展示。这样的好处是用户体验还算不错，因为用户可以实打实地看到结果，但该方案的缺点也十分明显，就是需要推翻之前写过的相关方法，因为当时考虑的时候就打算一下子全部加载出来，而且显示的结果也是已经进行排过序的，如果让用户先看到乱序的结果，一定会降低用户体验的。

以上是我们头脑风暴想到的三个值得考虑的方案，最后经过综合评估，决定选择了第二种方式，一是今后调用关卡数据也会更方便些；二是可以时刻获取到最新的掉落率，毕竟这种应用，“实时性”是最重要的决策因素，也是最值得考虑的因素；三是占用的空间也会更小一些，相比于第一种将全部的数据压入数据库，这种方案会更加轻便。

所以，最后如你所见，在初次加载矩阵时，会需要一段时间，但随着获取关卡数据的增加，所用的时间会成倍数下降，最后也可以实现在一瞬间加载出很多条关卡列表的能力。

以上是我这个项目遇到的一些想得起来的、值得说明的重点与难点。

同时在本项目编写代码的过程中，有一些问题也需要在今后的编写中重视起来：

比如包名、类名的定义并不明确，有一些类并不是工具类，但也放到了utils包中，有一些方法是一种工具，但并没有放入工具类中……

方法名、变量名的定义也不明确，在前期设置组件的编号和后期设置组件编号所用的格式并不统一（例如编辑框，有的时候我会使用viewEditText，有的时候会用viewEdit，甚至会用viewTextEdit等等），在以后查找某个组件会显得很无力。

以及没有单独为适配器创建独立的adapters包，这样展开某一个很复杂的类时会显得很杂乱无章，今后维护起来也会很难受。

虽然目前已经完成了应用内的所有必要组件和其代码的编写，但仍有一些遗憾，比如说首页按照“理智概率”算法进行排序、更完美的多语言显示功能、在材料概率界面点击材料图标可以切换排序方式（即选择掉落率或理智指数两种方式）等等功能没有实现或未能完美实现……希望今后如果还有机会进一步维护该应用，可以增加这些功能吧。

总之，对于编程，我还是蛮喜欢的。因为我享受代码成功运行后所获得的正向反馈的感觉，编程不会拐弯抹角，所见即所得。其次成功运行了代码后的愉悦感就像《明日方舟》中危机合约挑战新等级成功的感觉一样，令人感觉非常愉悦和爽快。
